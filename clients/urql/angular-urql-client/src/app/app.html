<div class="container">
  <header>
    <h1>{{ title() }}</h1>
    <p>Using urql GraphQL Client</p>
    <div class="header-stats">
      <span class="stat">Accounts: {{ accounts().length }}</span>
      <span class="stat">Reviews: {{ reviews().length }}</span>
    </div>
  </header>

  <main>
    @if (loading()) {
      <div class="loading">
        <div class="loading-spinner"></div>
        <span>Loading data from mesh gateway...</span>
      </div>
    }

    @if (error()) {
      <div class="error">
        <strong>Error:</strong> {{ error() }}
        <button (click)="refresh()" class="error-retry">Retry</button>
      </div>
    }

    <div class="controls">
      <button (click)="refresh()" class="refresh-btn" [disabled]="loading()">
        üîÑ Refresh Data
      </button>
    </div>

    <div class="content-grid">
      <section class="forms-panel">
        <div class="form-card">
          <div class="form-header">
            <h3>üíº Create Account</h3>
          </div>
          <div class="form-body">
            <div class="form-group">
              <label for="account-name">Full Name</label>
              <input 
                id="account-name"
                type="text" 
                [value]="newAccountName()" 
                (input)="newAccountName.set($any($event.target).value)"
                placeholder="Enter full name"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="account-email">Email Address</label>
              <input 
                id="account-email"
                type="email" 
                [value]="newAccountEmail()" 
                (input)="newAccountEmail.set($any($event.target).value)"
                placeholder="Enter email address"
                class="form-input">
            </div>
            <button 
              (click)="createAccount()" 
              class="submit-btn primary"
              [disabled]="!newAccountName() || !newAccountEmail() || loading()">
              Create Account
            </button>
          </div>
        </div>

        <div class="form-card">
          <div class="form-header">
            <h3>‚≠ê Create Review</h3>
          </div>
          <div class="form-body">
            <div class="form-group">
              <label for="review-account">Select Account</label>
              <select 
                id="review-account"
                [value]="selectedAccountId()" 
                (change)="selectedAccountId.set($any($event.target).value)"
                class="form-select">
                <option value="">Choose an account...</option>
                @for (account of accounts(); track account.id) {
                  <option [value]="account.id">{{ account.name }} ({{ account.email }})</option>
                }
              </select>
            </div>
            <div class="form-group">
              <label for="review-content">Review Content</label>
              <textarea 
                id="review-content"
                [value]="newReviewContent()" 
                (input)="newReviewContent.set($any($event.target).value)"
                placeholder="Share your thoughts..."
                rows="4"
                class="form-textarea"></textarea>
            </div>
            <div class="form-group">
              <label for="review-rating">Rating</label>
              <div class="rating-container">
                <select 
                  id="review-rating"
                  [value]="newReviewRating()" 
                  (change)="newReviewRating.set(+$any($event.target).value)"
                  class="form-select rating-select">
                  <option value="1">‚≠ê 1 Star</option>
                  <option value="2">‚≠ê‚≠ê 2 Stars</option>
                  <option value="3">‚≠ê‚≠ê‚≠ê 3 Stars</option>
                  <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4 Stars</option>
                  <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 Stars</option>
                </select>
              </div>
            </div>
            <button 
              (click)="createReview()" 
              class="submit-btn secondary"
              [disabled]="!selectedAccountId() || !newReviewContent() || loading()">
              Submit Review
            </button>
          </div>
        </div>
      </section>

      <section class="data-panel">
        <div class="data-section">
          <div class="section-header">
            <h2>üë• User Accounts</h2>
            <span class="count-badge">{{ accounts().length }}</span>
          </div>
          @if (accounts().length > 0) {
            <div class="accounts-grid">
              @for (account of accounts(); track account.id) {
                <div class="account-card">
                  <div class="card-avatar">{{ account.name.charAt(0) }}</div>
                  <div class="card-content">
                    <h3>{{ account.name }}</h3>
                    <p>{{ account.email }}</p>
                    <small>ID: {{ account.id }}</small>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <div class="empty-icon">üë•</div>
              <h3>No Accounts Found</h3>
              <p>Create your first account using the form above.</p>
            </div>
          }
        </div>

        <div class="data-section">
          <div class="section-header">
            <h2>üìù Reviews</h2>
            <span class="count-badge">{{ reviews().length }}</span>
          </div>
          @if (reviews().length > 0) {
            <div class="reviews-grid">
              @for (review of reviews(); track review.id) {
                <div class="review-card">
                  <div class="review-header">
                    <div class="rating-display">
                      @for (_ of [].constructor(review.rating); track $index) {
                        <span class="star">‚≠ê</span>
                      }
                      <span class="rating-text">{{ review.rating }}/5</span>
                    </div>
                    <small class="account-ref">Account: {{ review.accountId }}</small>
                  </div>
                  <div class="review-content">
                    <p>"{{ review.content }}"</p>
                  </div>
                  <div class="review-footer">
                    <small>Review ID: {{ review.id }}</small>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <div class="empty-icon">üìù</div>
              <h3>No Reviews Yet</h3>
              <p>Add your first review using the form above.</p>
            </div>
          }
        </div>
      </section>
    </div>
  </main>

  <router-outlet />
</div>